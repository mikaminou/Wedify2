openapi: 3.0.3
info:
  title: Wedify API
  description: Backend API for Wedify wedding planning application
  version: 0.0.1
  contact:
    name: Wedify Team

servers:
  - url: http://localhost:8081
    description: Development server

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check endpoint
      description: Returns the current health status of the API
      operationId: getHealth
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /api/v1/auth/signup/email:
    post:
      tags:
        - Auth
      summary: Sign up with email
      description: Registers a new user using email and password.
      operationId: signUpWithEmail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpEmailRequest'
            examples:
              default:
                summary: Basic signup
                value:
                  email: "user@example.com"
                  password: "strongpassword"
              withData:
                summary: With custom user data
                value:
                  email: "john@example.com"
                  password: "secret"
                  data:
                    first_name: "John"
                    age: 24
      responses:
        '200':
          description: Signup result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                confirmationRequired:
                  summary: Confirmation required
                  value:
                    success: true
                    user:
                      id: "uuid"
                      email: "user@example.com"
                      phone: null
                      createdAt: "2024-06-01T12:00:00Z"
                      confirmedAt: null
                    message: "User created, email confirmation required"
                loggedIn:
                  summary: User created and logged in
                  value:
                    success: true
                    user:
                      id: "uuid"
                      email: "user@example.com"
                      phone: null
                      createdAt: "2024-06-01T12:00:00Z"
                      confirmedAt: "2024-06-01T12:01:00Z"
                    message: "User created and logged in"
        '400':
          description: Invalid input or user already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /api/v1/auth/signup/phone:
    post:
      tags:
        - Auth
      summary: Sign up with phone
      description: Registers a new user using phone and password.
      operationId: signUpWithPhone
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpPhoneRequest'
            examples:
              sms:
                summary: SMS channel
                value:
                  phone: "+49123456789"
                  password: "strongpassword"
                  channel: "SMS"
              whatsapp:
                summary: WhatsApp channel
                value:
                  phone: "+49123456789"
                  password: "strongpassword"
                  channel: "WHATSAPP"
      responses:
        '200':
          description: Signup result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                confirmationRequired:
                  summary: Confirmation required
                  value:
                    success: true
                    user:
                      id: "uuid"
                      email: null
                      phone: "+49123456789"
                      createdAt: "2024-06-01T12:00:00Z"
                      confirmedAt: null
                    message: "User created, phone confirmation required"
                loggedIn:
                  summary: User created and logged in
                  value:
                    success: true
                    user:
                      id: "uuid"
                      email: null
                      phone: "+49123456789"
                      createdAt: "2024-06-01T12:00:00Z"
                      confirmedAt: "2024-06-01T12:01:00Z"
                    message: "User created and logged in"
        '400':
          description: Invalid input or user already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /api/v1/auth/login/email:
    post:
      tags:
        - Auth
      summary: Login with email
      description: Log in an existing user with email and password.
      operationId: loginWithEmail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginEmailRequest'
            examples:
              basic:
                summary: Basic login
                value:
                  email: "user@example.com"
                  password: "strongpassword"
      responses:
        '200':
          description: Login result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                success:
                  summary: Logged in
                  value:
                    success: true
                    user:
                      id: "uuid"
                      email: "user@example.com"
                      phone: null
                      createdAt: "2024-06-01T12:00:00Z"
                      confirmedAt: "2024-06-01T12:01:00Z"
                    message: "User logged in successfully"
        '400':
          description: Invalid credentials or input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /api/v1/auth/login/phone:
    post:
      tags:
        - Auth
      summary: Login with phone
      description: Log in an existing user with phone and password.
      operationId: loginWithPhone
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginPhoneRequest'
            examples:
              basic:
                summary: Basic phone login
                value:
                  phone: "+49123456789"
                  password: "strongpassword"
      responses:
        '200':
          description: Login result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                success:
                  summary: Logged in
                  value:
                    success: true
                    user:
                      id: "uuid"
                      email: null
                      phone: "+49123456789"
                      createdAt: "2024-06-01T12:00:00Z"
                      confirmedAt: "2024-06-01T12:01:00Z"
                    message: "User logged in successfully"
        '400':
          description: Invalid credentials or input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /api/v1/auth/forgot-password:
    post:
      tags:
        - Auth
      summary: Send password reset email
      description: Sends a password reset email to the provided address. Optionally include a redirect URL.
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
            examples:
              basic:
                summary: Basic forgot password
                value:
                  email: "user@example.com"
                  redirectUrl: "https://app.example.com/reset"
      responses:
        '200':
          description: Password reset email queued
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                sent:
                  summary: Reset email sent
                  value:
                    success: true
                    message: "Password reset email sent"
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /api/v1/auth/update-password:
    patch:
      tags:
        - Auth
      summary: Update password for authenticated user
      description: Update the current user's password. Requires authentication.
      operationId: updatePassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePasswordRequest'
            examples:
              basic:
                summary: Update password
                value:
                  newPassword: "newStrongPassword123"
      responses:
        '200':
          description: Password updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                success:
                  summary: Password updated
                  value:
                    success: true
                    user:
                      id: "uuid"
                      email: "user@example.com"
                      phone: null
                      createdAt: "2024-06-01T12:00:00Z"
                      confirmedAt: "2024-06-01T12:01:00Z"
                    message: "Password updated successfully"
        '400':
          description: Invalid input or unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /api/v1/vendors/businesses:
    post:
      tags:
        - Vendors
      summary: Create a new business
      description: Creates a new vendor business with regions, packages, promotions, rest days, and portfolio tags.
      operationId: createBusiness
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessDataRequest'
            examples:
              createExample:
                summary: Create business
                value:
                  basicInfo:
                    userId: "user-001"
                    serviceTypeId: "service-001"
                    businessName: "Test Business"
                    description: "A test business"
                  regions:
                    - vendorId: "test-vendor-123"
                      regionName: "Berlin"
                  packages:
                    - vendorId: "test-vendor-123"
                      packageName: "Standard"
                      price: 1000.0
                      features: ["Photography", "Video"]
                  promotions:
                    - vendorId: "test-vendor-123"
                      name: "Summer Sale"
                      originalPrice: 1200.0
                      discountPrice: 1000.0
                      startDate: "2024-07-01"
                      endDate: "2024-07-31"
                  restDays:
                    - vendorId: "test-vendor-123"
                      dayOfWeek: "SUNDAY"
                  portfolioTags:
                    - vendorId: "test-vendor-123"
                      taggedVendorId: "tagged-001"
                      fileId: "file-001"
      responses:
        '201':
          description: Business created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                created:
                  summary: Business created
                  value:
                    statusCode: 201
                    message: Business created successfully
                    id: "test-vendor-123"
        '400':
          description: Invalid business data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                invalid:
                  summary: Invalid data
                  value:
                    statusCode: 400
                    message: Invalid business data
        '409':
          description: Business already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                conflict:
                  summary: Conflict
                  value:
                    statusCode: 409
                    message: Business already exists
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                error:
                  summary: Error
                  value:
                    statusCode: 500
                    message: Internal server error
  /api/v1/vendors/businesses/{id}:
    delete:
      tags:
        - Vendors
      summary: Delete (roll out) a business
      description: Deletes (rolls out) a vendor business and all related data. Returns 404 if the business does not exist.
      operationId: deleteBusiness
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Vendor business unique identifier
      responses:
        '200':
          description: Business deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                deleted:
                  summary: Business deleted
                  value:
                    statusCode: 200
                    message: Business rollout successful
                    id: "test-vendor-123"
        '400':
          description: Missing or malformed id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                missing:
                  summary: Missing or malformed id
                  value:
                    statusCode: 400
                    message: Missing or malformed id
        '404':
          description: Business not found or rollout failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                notFound:
                  summary: Not found
                  value:
                    statusCode: 404
                    message: Business not found or rollout failed
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                error:
                  summary: Error
                  value:
                    statusCode: 500
                    message: Internal server error

components:
  schemas:
    HealthResponse:
      type: object
      required:
        - status
        - version
        - timestamp
      properties:
        status:
          type: string
          example: healthy
        version:
          type: string
          example: 0.0.1
        timestamp:
          type: integer
          format: int64
          example: 1699900000000
    SignUpEmailRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        redirectUrl:
          type: string
          format: uri
          nullable: true
        data:
          type: object
          additionalProperties: true
          nullable: true
    SignUpPhoneRequest:
      type: object
      required:
        - phone
        - password
      properties:
        phone:
          type: string
        password:
          type: string
          format: password
        channel:
          type: string
          enum: [SMS, WHATSAPP]
          default: SMS
    LoginEmailRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
    LoginPhoneRequest:
      type: object
      required:
        - phone
        - password
      properties:
        phone:
          type: string
        password:
          type: string
          format: password
    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
        redirectUrl:
          type: string
          format: uri
          nullable: true
    UpdatePasswordRequest:
      type: object
      required:
        - newPassword
      properties:
        newPassword:
          type: string
          format: password
    AuthUserInfo:
      type: object
      required:
        - id
      properties:
        id:
          type: string
        email:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
          nullable: true
        confirmedAt:
          type: string
          format: date-time
          nullable: true
    AuthResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
        user:
          $ref: '#/components/schemas/AuthUserInfo'
          nullable: true
        message:
          type: string
          nullable: true
        error:
          type: string
          nullable: true
    BusinessDataRequest:
      type: object
      required:
        - basicInfo
        - regions
        - packages
        - promotions
        - restDays
      properties:
        basicInfo:
          $ref: '#/components/schemas/Vendors'
        regions:
          type: array
          items:
            $ref: '#/components/schemas/VendorRegions'
        packages:
          type: array
          items:
            $ref: '#/components/schemas/VendorPackages'
        promotions:
          type: array
          items:
            $ref: '#/components/schemas/VendorPromotions'
        restDays:
          type: array
          items:
            $ref: '#/components/schemas/VendorsRestDays'
        portfolioTags:
          type: array
          items:
            $ref: '#/components/schemas/VendorsPortfolioTags'
          nullable: true
    ApiResponse:
      type: object
      required:
        - statusCode
        - message
      properties:
        statusCode:
          type: integer
        message:
          type: string
    Vendors:
      type: object
      required:
        - userId
        - serviceTypeId
        - businessName
      properties:
        userId:
          type: string
        serviceTypeId:
          type: string
        businessName:
          type: string
        description:
          type: string
          nullable: true
        rating:
          type: number
          format: float
          nullable: true
        reviewCount:
          type: integer
          nullable: true
        id:
          type: string
          nullable: true
          description: Vendor unique identifier (nullable, assigned by backend)
    VendorRegions:
      type: object
      required:
        - vendorId
        - regionName
      properties:
        vendorId:
          type: string
        regionName:
          type: string
        id:
          type: string
          nullable: true
    VendorPackages:
      type: object
      required:
        - vendorId
        - packageName
        - price
        - features
      properties:
        vendorId:
          type: string
        packageName:
          type: string
        price:
          type: number
          format: double
        features:
          type: array
          items:
            type: string
        description:
          type: string
          nullable: true
        isDailyBooking:
          type: boolean
          nullable: true
        hourRange:
          type: integer
          nullable: true
        hasMultipleBookings:
          type: boolean
          nullable: true
        id:
          type: string
          nullable: true
    VendorPromotions:
      type: object
      required:
        - vendorId
        - name
        - originalPrice
        - discountPrice
        - startDate
        - endDate
      properties:
        vendorId:
          type: string
        name:
          type: string
        originalPrice:
          type: number
          format: double
        discountPrice:
          type: number
          format: double
        startDate:
          type: string
        endDate:
          type: string
        id:
          type: string
          nullable: true
        packageId:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        benefits:
          type: array
          items:
            type: string
          nullable: true
        features:
          type: array
          items:
            type: string
          nullable: true
    VendorsRestDays:
      type: object
      required:
        - vendorId
        - dayOfWeek
      properties:
        vendorId:
          type: string
        dayOfWeek:
          type: string
        id:
          type: string
          nullable: true
    VendorsPortfolioTags:
      type: object
      required:
        - vendorId
        - taggedVendorId
        - fileId
      properties:
        vendorId:
          type: string
        taggedVendorId:
          type: string
        fileId:
          type: string
        id:
          type: string
          nullable: true

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Supabase JWT token
